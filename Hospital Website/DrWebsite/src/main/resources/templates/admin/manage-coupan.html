<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" th:lang="en">
<meta http-equiv="content-type" content="text/html;charset=UTF-8" />

<head th:replace="admin/common/layout :: super-admin-header-link"></head>

<body>
	<!-- Begin page -->
	<div id="wrapper">
		<!-- Top Bar Start -->
		<div class="topbar"
			th:replace="admin/common/layout :: super-admin-navbar"></div>
		<!-- Top Bar End -->
		<!-- ========== Left Sidebar Start ========== -->
		<div class="left side-menu"
			th:replace="admin/common/layout :: super-admin-sidebar"></div>
		<!-- Left Sidebar End -->
		<!-- ============================================================== -->
		<!-- Start right Content here -->
		<!-- ============================================================== -->
		<div class="content-page">
			<!-- Start content -->
			<div class="content">
				<div class="container-fluid">
					<div class="row">
						<div class="col-sm-12">
							<!-- test -->
							<div class="page-title-box">
								<div class="card m-b-20">
									<div class="card-body">
										<div class="row ">
											<div class="col-md-12 m-b-15">
												<h4 class="mt-0 header-title">
													 Coupon Details
													<!-- 													 <button class="btn btn-primary btn-md m-1" type="button" data-toggle="modal" data-target="#addModal" style="float: right;">Add Enquiry</button>
													 -->
													<button class="btn btn-primary btn-md m-1" type="button"
														data-toggle="modal" data-target="#addModal"
														style="float: right;">Create Coupon</button>
												</h4>
											</div>
											<div class="col-md-12 table-responsive">

												<table class=" table table-striped dt-responsive nowrap"
													id="datatable-buttons"
													style="border-collapse: collapse; border-spacing: 0; width: 100%;">
													<thead>
														<tr>													
															<th>Coupon Name</th>
															<th>Coupon Code</th>
															<th>Coupon Price</th>
															<th>Max Price</th>												
															<th>Status</th>																
															<th>Created Date</th>	
															<th>Action</th>	
															<th>Start Date</th>
															<th>End Date</th>										
														</tr>
													</thead>
													<tbody id="showData">
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>

						</div>
					</div>
					<div class="modal fade " id="addModal" tabindex="-1" role="dialog"
						aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
						<div
							class="modal-dialog modal-lg modal-dialog-centered modal-dialog-centered">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title" id="exampleModalCenterTitle">Create
										Coupon</h5>
									<button class="close" type="button" data-dismiss="modal"
										aria-label="Close">
										<span aria-hidden="true">×</span>
									</button>
								</div>
								<div class="modal-body">
									<form id="insert">
										<div class="row">
											<div class="col-md-6 form-group mb-3">
											<!-- 												// style="text-transform: uppercase;" -->
												<label for="name">Coupon Name</label> <input
													class="form-control form-control-rounded" name="couponName"
													type="text"  title="only capital letters allowed" required />
											</div>
											<div class="col-md-6 form-group mb-3">
												<label for="name">Coupon Code</label> <input
													class="form-control form-control-rounded" name="couponCode"
													type="text"   required />
											</div>
											<div class="col-md-6 form-group mb-3">
												<label for="name">Coupon Price </label> <input
													class="form-control form-control-rounded"
													name="couponPrice" type="text" pattern="[0-9]+"  title="Enter number only" required />
											</div>
											
											<div class="col-md-6 form-group mb-3">
												<label for="name">Max Price</label> <input
													class="form-control form-control-rounded" name="maxPrice"
													type="text" pattern="[0-9]+"  title="Enter number only" required />
											</div>
											<div class="col-md-6 form-group mb-3">
												<label for="name">Start Date</label> <input
													class="form-control form-control-rounded" name="startDate" id="startDate"
													th:attr="min=${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}"
													type="date" required />
											</div>
											<div class="col-md-6 form-group mb-3">
												<label for="name">End Date</label> <input
													class="form-control form-control-rounded" name="endDate" id="endDate"
													
													type="date" required />
											</div>

<!-- 											<div class="col-md-6 form-group mb-3"> -->
<!-- 												<label for="accountType"> Status</label> <select -->
<!-- 													class="form-control form-control-rounded accounttype" -->
<!-- 													id="status" name="couponStatus" required> -->
<!-- 													<option value="">Select Status</option> -->
<!-- 													<option value="Active">Active</option> -->
<!-- 													<option value="InActive">InActive</option> -->


<!-- 												</select> -->
<!-- 											</div> -->
<!-- <input type="hidden" id="couponStatus" name="couponStatus" value="Active"> -->


											<div class="col-md-12 modal-footer mt-3">
												<button class="btn btn-secondary" type="button"
													data-dismiss="modal">Close</button>
												<input class="btn btn-primary ml-2 submit" type="submit"
													value="Save">
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
					<div class="modal fade " id="editModal" tabindex="-1" role="dialog"
						aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
						<div
							class="modal-dialog modal-lg modal-dialog-centered modal-dialog-centered">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title" id="exampleModalCenterTitle">Edit
										Coupon</h5>
									<button class="close" type="button" data-dismiss="modal"
										aria-label="Close">
										<span aria-hidden="true">×</span>
									</button>
								</div>
								<div class="modal-body">
									<form id="update">
										<div class="row">
											
													 <input class="form-control form-control-rounded" name="id"
													id="id1" type="hidden" required />
											

											<div class="col-md-6 form-group mb-3">
												<label for="name">Coupon Name</label> <input
													class="form-control form-control-rounded" name="couponName"
													id="couponName1" type="text" style="text-transform: uppercase;" required />
											</div>
											<div class="col-md-6 form-group mb-3">
												<label for="name">Coupon Code</label> <input
													class="form-control form-control-rounded" id="couponCode1" name="couponCode"
													type="text" required />
											</div>
											<div class="col-md-6 form-group mb-3">
												<label for="name">Coupon Price </label> <input
													class="form-control form-control-rounded"
													name="couponPrice" id="couponPrice1" type="text" pattern="[0-9]+"  title="Enter number only"  required />
											</div>
											
											<div class="col-md-6 form-group mb-3">
												<label for="name">Max Price</label> <input
													class="form-control form-control-rounded" name="maxPrice"
													id="maxPrice1" type="text" pattern="[0-9]+"  title="Enter number only" required />
											</div>
											<div class="col-md-6 form-group mb-3">
												<label for="name">Start Date</label> <input
													class="form-control form-control-rounded" name="startDate"
													th:attr="min=${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}" id="startDate1" type="date" required />
											</div>
											<div class="col-md-6 form-group mb-3">
												<label for="name">End Date</label> <input
													class="form-control form-control-rounded" name="endDate"
													th:attr="min=${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}" id="endDate1" type="date" required />
											</div>

<!-- 											<div class="col-md-6 form-group mb-3"> -->
<!-- 												<label for="accountType"> Status</label> <select -->
<!-- 													class="form-control form-control-rounded accounttype" -->
<!-- 													id="couponStatus1" name="couponStatus" required> -->
<!-- 													<option value="">Select Status</option> -->
<!-- 													<option value="Active">Active</option> -->
<!-- 													<option value="InActive">InActive</option> -->


<!-- 												</select> -->
<!-- 											</div> -->
<input type="hidden" id="couponStatus1" name="couponStatus">

											<div class="col-md-12 modal-footer mt-3">
												<button class="btn btn-secondary" type="button"
													data-dismiss="modal">Close</button>
												<input class="btn btn-primary ml-2 submit" type="submit"
													value="Save">
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>


				</div>
			</div>
		</div>
	</div>
	<div th:replace="admin/common/layout :: super-admin-footer-link"></div>
	<script type="text/javascript">
		$('document').ready(function() {
			showAllCouponList();
		});

		function showAllCouponList() {
			$('#datatable-buttons').DataTable().destroy();
			$
					.ajax({

						type : "ajax",
						dataType : 'json',
						url : "/get-coupon-list",
						method : 'GET',
						async : false,
						dataType : 'json',
						success : function(data) {
							
							var html = '';
							var i;
							for (i = 0; i < data.length; i++) {
					               var arr = ["Jan", "Feb", "Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"];

					           
					               
								var date = new Date(data[i].createdDate);
								var from_dd = date.getDate();
								var from_mm = date.getMonth()+1;
								var from_yyyy = date.getFullYear();
								var from = from_yyyy + '-' + arr[from_mm] + '-'
										+ from_dd;
								var from_hours = date.getHours() > 12 ? date
										.getHours() - 12 : date.getHours();
								var from_am_pm = date.getHours() >= 12 ? "PM"
										: "AM";
								hours = from_hours < 10 ? "0" + from_hours
										: from_hours;
								var from_minutes = date.getMinutes() < 10 ? "0"
										+ date.getMinutes() : date.getMinutes();
								var from_seconds = date.getSeconds() < 10 ? "0"
										+ date.getSeconds() : date.getSeconds();
								createdDate =  from_dd + '/' + from_mm + '/'
									+ from_yyyy + ' ' + from_hours + ":"
								+ from_minutes + " " + from_am_pm;

								
								if(data[i].endDate != null)
								{
								
									var date = new Date(data[i].endDate);
									var from_dd = date.getDate();
									var from_mm = date.getMonth()+1;
									var from_yyyy = date.getFullYear();
									var from = from_yyyy + '-' + arr[from_mm] + '-'
											+ from_dd;
									var from_hours = date.getHours() > 12 ? date
											.getHours() - 12 : date.getHours();
									var from_am_pm = date.getHours() >= 12 ? "PM"
											: "AM";
									hours = from_hours < 10 ? "0" + from_hours
											: from_hours;
									var from_minutes = date.getMinutes() < 10 ? "0"
											+ date.getMinutes() : date.getMinutes();
									var from_seconds = date.getSeconds() < 10 ? "0"
											+ date.getSeconds() : date.getSeconds();
											endDate =  from_dd + '/' + from_mm + '/'
											+ from_yyyy ;
								}
								else
								{
									endDate = ''
								}
								
								if(data[i].startDate != null)
								{
									
										var date = new Date(data[i].startDate);
										var from_dd = date.getDate();
										var from_mm = date.getMonth()+1;
										var from_yyyy = date.getFullYear();
										var fromDate = from_dd + '/' + from_mm + '/'+from_yyyy;
								}
								else
								{
									startDate = ''
								}
								
								html += '<tr>'
										+ '<td>' + data[i].couponName+ '</td>' 
										+ '<td>' + data[i].couponCode+ '</td>' 
										+ '<td>' + data[i].couponPrice + '</td>'
										+ '<td>' + data[i].maxPrice + '</td>'										
										+ '<td>' + data[i].couponStatus + '</td>' 																			
										+ '<td>' + createdDate + '</td>'
										+ '<td>'
										+ '<a class="text-success mr-2 edit" data="' + data[i].id + '" href="javascript:;"><i class="dripicons-document-edit"></i></a>'
										+ '<a class="text-danger mr-2 delete" data="' + data[i].id + '" href="javascript:;"><i class="dripicons-document-delete"></i></a>' 
										+ '</td>'
										+ '<td>' + fromDate + '</td>' 
										+ '<td>' + endDate + '</td>' 
										' </tr>';

							}
							$('#showData').html(html);

							$('#datatable-buttons')
									.DataTable({
										destroy : true,
										lengthChange : false,
										sort : [ 2, "asc" ],
										 "iDisplayLength": 100,
										buttons : [ 'copy', 'excel', 'colvis' ]
									})
									.buttons()
									.container()
									.appendTo(
											'#datatable-buttons_wrapper .col-md-6:eq(0)');

						},
						error : function() {
							alert('could not get data from database');
						}
					});
		}

		$(document).on('submit', '#insert', function(e) {
			e.preventDefault();
			$.ajax({
				type : "ajax",
				method : "POST",
				url : "/create-coupon",
				data : new FormData(this),
				processData : false,
				contentType : false,
				cache : false,
				beforeSend : function() {
					$(".submit").prop('disabled', true);
				},

				success : function(data) {
					$(".submit").prop('disabled', false);
					if(data.status != "true")
					{
						alert(data.message);	
					}
					else
					{
						$(".submit").prop('disabled', true);
						$('#insert')[0].reset();
						$('#addModal').modal('hide');
						showAllCouponList();
					}

				},
				error : function() {
					alert('could not insert');
				}
			});
		});

		$('#showData').on('click', '.edit', function() {
			var id = $(this).attr('data');
			$('#editModal').modal('show');

			$.ajax({
				type : 'ajax',
				method : 'POST',
				url : "/get-coupon-by-id",
				data : {
					id : id
				},
				async : false,
				dataType : 'json',
				success : function(data) {
				
					$("#id1").val(data.id);
					$("#couponName1").val(data.couponName);
					$("#couponCode1").val(data.couponCode);
					$("#couponPrice1").val(data.couponPrice);
					$("#maxPrice1").val(data.maxPrice);
					$("#startDate1").val(data.startDate);
					$("#endDate1").val(data.endDate);
					$("#couponStatus1").val(data.couponStatus);

				},
				error : function() {
					alert('Could not Edit Data');
				}
			});
		});

		$(document).on('submit', '#update', function(e) {

			e.preventDefault();

			$.ajax({
				url : "/update-coupon",
				method : 'PUT',
				data : new FormData(this),
				contentType : false,
				processData : false,
				cache : false,
				beforeSend : function() {

					$(".submit").prop('disabled', true);
				},

				success : function(data) {
					$(".submit").prop('disabled', false);
					$('#update')[0].reset();
					$('#editModal').modal('hide');

					showAllCouponList();

				},
				error : function() {
					/*alert('could not insert');*/
				}
			});

		});

		$(document).on('click', '.delete', function() {
			var Id = $(this).attr('data');
			if (confirm('Are you want to delete this?'))
				$.ajax({
					method : "DELETE",
					url : "/delete-coupon-by-id",
					data : {
						id : Id
					},
					success : function(data) {
						showAllCouponList();
					},
					error : function() {
						alert('could not delete');
					}
				});
		});
		
		$("#startDate").change(function() {
			
			var startDate = $('#startDate').val();
			$('#endDate').attr("min",startDate);
			
			
		});
	$("#startDate1").change(function() {
			
			var startDate = $('#startDate1').val();
			$('#endDate1').attr("min",startDate);
			
			
		});
		
				
		
		
	</script>
</body>

</html>